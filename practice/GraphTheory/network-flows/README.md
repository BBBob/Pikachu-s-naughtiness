# 网络流

## swust P1736 飞行员配对方案问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1736
### 题意
有两种飞行员，一种可以和另一种的几个飞行员配对，求最大匹配。
### 题解
二分图最大匹配问题。

在二分图的基础上增加源S和汇T，一种飞行员为X集合，另一种为Y集合。
1、S向X集合中每个顶点连一条容量为1的有向边。
2、Y集合中每个顶点向T连一条容量为1的有向边。
3、XY集合之间的边都设为从A集合中的点到B集合之中的点，容量为1的有向边。
求网络最大流，流量就是匹配数，所有满流边是一组可行解。（匈牙利写起来更方便）


## swust P1737 太空飞行计划问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1737
### 题意
有 n 个实验，每个实验有收入 xi ，而且实验会使用 mi 个仪器。每个仪器会有 yi支出。问实施哪些实验并配置哪些仪器使收入最大。
### 题解
最大权闭合图问题，可以转化成最小割问题，进而用最大流解决。

把每个实验看作二分图 X 集合中的顶点，每个设备看作二分图 Y 集合中的顶点，增加源 S 和汇 T。
1、从 S 向每个 Xi 连接一条容量为该点收入的有向边。
2、从 Yi 向 T 连接一条容量为该点支出的有向边。
3、如果一个实验 i *需要*设备 j ，连接一条从 Xi 到 Yj 容量为**无穷大**的有向边。

统计出所有实验的收入只和Total，求网络最大流Maxflow，最大收益就是Total - Maxflow。对应的解就是最小割划分出的 S 集合中的点，也就是最后一次增广找到阻塞流时能从 S 访问到的顶点。
定义一个割划分出的S集合为一个解，那么割集的容量之和就是(未被选的 A 集合中的顶点的权值 + 被选的 B 集合中的顶点的权值)，记为Cut。 A 集合中所有顶点的权值之和记为Total，那么Total - Cut就是(被选的 A 集合中的顶点的权值 - 被选的 B 集合中的顶点的权值)，即为我们的目标函数，记为 A 。要想最大化目标函数 A ，就要尽可能使Cut小，Total是固定值，所以目标函数 A 取得最大值的时候，Cut最小，即为最小割。


## swust P1738 最小路径覆盖问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1738
### 题意
问最少多少条路径可以覆盖一个有向无环图所有的点。
### 题解
有向无环图最小路径覆盖，可以转化成二分图最大匹配问题，从而用最大流解决。

构造二分图，把原图每个顶点i拆分成二分图X，Y集合中的两个顶点Xi和Yi。对于原图中存在的每条边(i,j)，在二分图中连接边(Xi,Yj)。然后把二分图最大匹配模型转化为网络流模型，求网络最大流。
最小路径覆盖的条数，就是原图顶点数，减去二分图最大匹配数（因为路径长度可为0，所以最大路径覆盖数为顶点数，每多一条边则少一个路径覆盖）。沿着匹配边查找，就是一个路径上的点，输出所有路径即可。


## swust P1739 魔术球问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1739
### 题意
问 n 根柱子一共可以放下多少个球。放球规则为数字从小到大依次放且每根柱子的相邻的两个球的值相加为平方数。
### 题解
有向无环图最小路径覆盖，可以转化成二分图最大匹配问题，从而用最大流解决。

先从 1 至无穷枚举可能放下多少个球（不能二分，因为二分得重新构图）。一旦数字 m 放不下则结束枚举。
可以把所有的球看成有向无环图的点，柱子看成路径。所以问题就成了最小路径覆盖 m 个点。
先拆点，枚举的时候每加一个点 xi 与源点相连， yi 与汇点相连，再连小于这个点且能与他相加能开方的点的边 xi -> yj 。一旦 m 个点覆盖的路径大于 n ，则结束枚举，并输出 m - 1 。


## swust P1740 圆桌问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1740
### 题意
要把 n 个单位的人安排到 m 个餐桌上（同个餐桌不能有来自相同单位的人）。 
### 题解
二分图多重匹配问题，可以用最大流解决。

建立二分图，每个单位为X集合中的顶点，每个餐桌为Y集合中的顶点，增设附加源S和汇T。 
1、从S向每个Xi顶点连接一条容量为该单位人数的有向边。
2、从每个Yi顶点向T连接一条容量为该餐桌容量的有向边。
3、X集合中每个顶点向Y集合中每个顶点连接一条容量为1的有向边（每个单位只能有一个人去一个餐桌）。 
求网络最大流，如果最大流量等于所有单位人数之和，则存在解，否则无解。对于每个单位，从X集合对应点出发的所有满流边指向的Y集合的顶点就是该单位人员的安排情况（一个可行解）。


## swust P1741 最长递增子序列问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1741
### 题意
计算序列的最长递增子序列的长度 s 。 并给出序列中最多可取出多少个长度为 s 的递增子序列。 
如果允许在取出的序列中多次使用 x1 和 xn ，则从给定序列中最多可取出多少个长度为 s 的递增子序列。
### 题解
分层图问题，可用最大流解决。

先 dp 出每个 i 的最长递增子序列 F[i] 。
对于规则1，将n个值拆点，拆成 xi 与 yi 。将 xi 与 yi 相连，容量为 1 。
如果 F[i] = s ,则将 xi 与源点相连，如果 F[i] = 1 ，则将 yi 与汇点相连。容量为 1 。
如果 i < j 且 F[i] + 1 = F[j] ,连接 yi 与 xj 。容量为 1 。
对于规则2，将n个值拆点，拆成 xi 与 yi 。将 xi 与 yi 相连，容量为 1 。（ 1 与 n 点容量为无穷）。
如果 F[i] = s ,则将 xi 与源点相连，如果 F[i] = 1 ，则将 yi 与汇点相连。容量为 1 。
如果 i < j 且 F[i] + 1 = F[j] ,连接 yi 与 xj 。容量为 1 。
求最大流。

## swust P1742 试题库问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1742
### 题意
试题库中有 n 道题（每道题各有几种属性，共有 k 种属性），现在每种类型各需要 mi 道题共 m 道题组成一套试卷，问是否能组成，能的话输出选择的题目。
### 题解
二分图多重匹配问题，用最大流解决。

建立二分图，每个类别为X集合中的顶点，每个题为Y集合中的顶点，增设附加源S和汇T。
1、从S向每个Xi连接一条容量为该类别所需数量的有向边。
2、从每个Yi向T连接一条容量为1的有向边。
3、如果一个题i属于一个类别j，连接一条从Xj到Yi容量为1的有向边。
求网络最大流，如果最大流量等于所有类别所需之和，则存在解，否则无解。对于每个类别，从X集合对应点出发的所有满流边，指向的B集合中的顶点就是该类别的所选的题（一个可行解）。


## swust P1744 方格取数
题目链接：https://www.oj.swust.edu.cn/problem/show/1744
### 题意
一个方格取出一些数（所有的数都不想邻）的和最大。
### 题解
选出的点满足任意两个都不相邻，这是点独立集的概念。 
使选出的总和最大:最大点权独立集。 
最大点权独立集 = 总点权 - 最小点权覆盖集 = 总点权 - 最小割 = 总点权 - 最大流。 
取得数总和最大转化为不取的损失最小。 
所以问题即可以转化为割掉最小的边，使原图不连通（即找不出方格中相邻且二分图中有边相连的点）。 

把棋盘黑白染色。 
对于黑色的，连接源点，容量为格子中的数。 
对于白色的，连接汇点，容量为格子中的数。 
然后把所有黑点和**相邻**的白点连边，容量**无穷大**。 
于是我们构造出了一个**二分图**。 
题目说不能取相邻的格子，那么对于这张二分图来说，就不能让他有一条边有流经过（否则就取了两个相邻的格子了）。 
于是求最小割即可。等于求最大流。 
最后用总和减去最小割即可。


## swust P1745 餐巾计划问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1745
### 题意
一个餐厅 n 天里每天都需要 x 餐巾，可以选择花费 p 元购买新的，也可以选择将已有的花 s 元送去慢洗 m 天，或者花 f 元送去快洗 k 天，或者延期洗。要花费最小。
### 题解
最小费用最大流问题。

将 n 天拆点，拆成 xi 与 yi。
将 xi 与源点相连，容量为 x，花费为 0。将 yi 与汇点相连，容量为 x，花费为 0。
将 xi 与 yi + m 相连，容量无穷，费用为 s 。将 xi 与 yi + k 相连，容量无穷，费用为 f 。
将 xi 与 xi + 1 相连，容量无穷，费用为 0 。
将源点与 yi 相连，容量为无穷，费用为 p。
求最小费用最大流。


## swust P1746 航空路线问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1746
### 题意
给一幅图，求从最西边到最东边再回到最西边经过的城市最多。（除了起点其他城市只能走一次）
### 题解
最大费用最大流问题。

将 n 个城市拆点，拆成 xi 与 yi。
将 xi 与 yi相连，容量为 1 ，费用为 1 。起点与终点容量为 2 。（如果这个点流量为 1 ，表示这个点被使用。）
如果两城市相连则连接 xi 与 yj ，容量为 1 ，费用为 0 。
从起点到终点跑最小费用最大流。


## swust P1748 星际转移问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1748
### 题意
人得借助 m 艘太空船（容量限定）与 n 个空间站从地球转移到月球，每艘太空船每天有规律的停靠在某个空间站，问最少多少天转移所有人。 
### 题解
分层图网络流问题，枚举答案。

我们把网络优化问题转化为枚举答案+可行性判定问题。枚举天数，按天数把图分层，因为乘船每坐一站天数都要增加一，把太空船航线抽象成图中的一条边，跨图的两层。由于太空船容量有限，边上也要加上容量限制。除了坐船以外，人还可以在某个空间站等待下一班太空船的到来，所以每个点要与下一层同一点连接一条容量为无穷的边。

从源点向每一天的地球链接一条容量无穷的边。 
从每一天的月亮向汇点链接一条容量无穷的边。 
从上一天的每一个节点向当天的对应节点链接一条容量无穷的边（因为人们可以留在中转站等一等）。 
针对每一艘飞船，获取其上一天的位置，再获取这一天的位置，在这两个点之间连一条容量为飞船满载人数的流。 
每次新加一天然后跑到最大流超过k即可。 
至于无解的情况只要当ans达到一个很大的值的时候跳出来即可。


## swust P1751 数字梯形问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1751
### 题意
梯形的第一行有m 个数字。
从梯形的顶部的m 个数字开始，在每个数字处可以沿左下或右下方向移动，形成一条从梯形的顶至底的路径。
规则1：从梯形的顶至底的m条路径互不相交。
规则2：从梯形的顶至底的m条路径仅在数字结点处相交。
规则3：从梯形的顶至底的m条路径允许在数字结点相交或边相交。
### 题解
求图的最大权不相交路径及其变种，用最大费用最大流解决。

把梯形每个位置拆点为 xi 与 yi 。（因为要保证每个点只能用一次）
xi 与 yi 相连容量为 1 ，费用为点值。
从一点向它的左下或右下（ yi 与 xj ）分别连接一条容量为 1 ，费用为 0 的边。
第一层的点与源点相连，容量为 1 ，费用为 0。
最后一层的点与汇点相连，容量为 1 ，费用为 0。

对于规则 2 ，不用拆点，因为不限制点的使用。
从一点向它的左下或右下（ xi 与 xj ）分别连接一条容量为 1 ，费用为点值的边。
第一层的点与源点相连，容量为 1 ，费用为 0。
最后一层的点与汇点相连，容量为无穷，费用为点值。（无穷因为不限制点的使用）

对于规则 3 ，只需要把规则 2 中除了第一层与源点连边之外的边容量全部改为无穷大。（因为不限制边的使用）


## swust P1752 运输问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1752
### 题意
把 m 个仓库的 ai 货物运送到 n 个需求为 bi 的商店去，第 i 个仓库运到第 j 个商店的费用为 cij 。求最小与最大费用。
### 题解
费用流问题。

把所有仓库看做二分图中顶点Xi，所有零售商店看做二分图中顶点Yi，建立附加源S汇T。
从S向每个Xi连一条容量为仓库中货物数量ai，费用为0的有向边。
从每个Yi向T连一条容量为商店所需货物数量bi，费用为0的有向边。
从每个Xi向每个Yj连接一条容量为无穷大，费用为cij的有向边。
求最小费用最大流，最小费用流值就是最少运费，求最大费用最大流，最大费用流值就是最多运费。


## swust P1753 分配问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1753
### 题意
n 个人需要工作，第 i 个人需要第 j 个工作的工资为 cij。求最小与最大费用。
### 题解
费用流问题。

把所有人看做二分图中顶点Xi，所有工作看做二分图中顶点Yi，建立附加源S汇T。
从S向每个Xi连一条容量为1，费用为0的有向边。
从每个Yi向T连一条容量为1，费用为0的有向边。
从每个Xi向每个Yj连接一条容量为无穷大，费用为Cij的有向边。
求最小费用最大流，最小费用流值就是最少工资，求最大费用最大流，最大费用流值就是最多工资。


## swust P1754 负载平衡问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1754
### 题意
有 n 个环形仓库存着不同的货物，求最小步数使得所有仓库货物相等。
### 题解
费用流问题。

首先求出所有仓库存货量平均值，设第i个仓库的盈余量为A[i]，A[i] = 第i个仓库原有存货量 - 平均存货量。建立二分图，把每个仓库抽象为两个节点Xi和Yi。增设附加源S汇T。
如果A[i]>0，从S向Xi连一条容量为A[i]，费用为0的有向边。（有盈余）
如果A[i]<0，从Yi向T连一条容量为-A[i]，费用为0的有向边。（需添加）
每个Xi向两个相邻顶点j，从Xi到Xj连接一条容量为无穷大，费用为1的有向边，从Xi到Yj连接一条容量为无穷大，费用为1的有向边。（旁边可能是终点，也可能是中转站）
求最小费用最大流，最小费用流值就是最少搬运量。


## swust P1755 深海机器人问题
题目链接：https://www.oj.swust.edu.cn/problem/show/1755
### 题意
深海资源考察探险队的潜艇将到达深海的海底进行科学考察。潜艇内有多个深海机器人。潜艇到达深海海底后，深海机器人将离开潜艇向预定目标移动。深海机器人在移动中还必须沿途采集海底生物标本。沿途生物标本由最先遇到它的深海机器人完成采集。每条预定路径上的生物标本的价值是已知的，而且生物的标本只能采集一次。本题限定深海机器人只能从其出发的位置沿着向北或者向东方向移动，而且多个深海机器人可以在同一时间占据同一位置。
### 题解
费用流问题。

把网格中每个位置抽象成网络中一个节点，建立附加源S汇T。
对于每个顶点i，j为i东边或南边相邻的一个节点，连接节点i与节点j一条容量为1，费用为该边价值的有向边。（每个点的价值只能使用一次）
对于每个顶点i，j为i东边或南边相邻的一个节点，连接节点i与节点j一条容量为无穷大，费用为0的有向边。（多个机器人可同时在同点，不限制点的使用）
从S到每个出发点i连接一条容量为该点出发的机器人数量，费用为0的有向边。
从每个目标点i到T连接一条容量为可以到达该点的机器人数量，费用为0的有向边。
求最大费用最大流，最大费用流值就采集到的生物标本的最高总价值。


## poj P1149 PIGS
题目链接：http://poj.org/problem?id=1149
### 题意
有 m 个猪圈与 n 个客人，每个客人可以到 k 个猪圈买猪，最多可以买 x 头猪，（每个顾客走后他所打开的猪圈里的猪可以任意交换）求所有顾客最多可以买多少猪。
### 题解
最大流

<br/>可以想到每个猪圈都有第一个顾客，后面的顾客可以拿的数量取决于前面的顾客所拿的数量，所以就单个猪圈而言，当前顾客可拿量取决于上一个顾客。所以可以拿同一个猪圈的顾客 i 与 i + 1 连边，边权为无穷。</br>
<br/>这样除每个猪圈第一顾客后的所有顾客都有了猪的来源，再将每个猪圈的第一个顾客与源点连边，边权为猪圈中猪数量，这样第一个顾客也有了猪的来源。</br>
<br/>再将每个顾客与汇点连边，边权为其最多可买的猪的数量。</br>
<br/>跑一次最大流即为答案。</br> 


## poj P2391 Ombrophobic Bovines
题目链接：http://poj.org/problem?id=2391
### 题意
有 n 个牛棚，每个牛棚有其牛的数量与其容量，现在下雨了，求最少的时间把所有的牛放到牛棚里。
### 题解
最大流

<br/>先用 floyd 求出每个点之间的最短路，那么时间限制了点对之间是否可以连边。</br>
<br/>二分时间，拆点与源汇连边，如果两点间的距离小于等于时间则连边。如果跑出满流证明时间可满足。</br>
<br/>最后通过二分求出答案。</br>


## 2017urumuqi j
题目链接：
### 题意
从一个点经过另一个点到一个点的最小费用（每个点只能经过一次）。
### 题解
费用流

<br/>相当于求从起点和终点到中转点的最小费用和。</br>
<br/>因为限制点只能使用一次，所以拆点，i 和 i + 1 点的费用都为 0 ，容量除中转点外都为 1 ，中转点容量为 2 。</br>
<br/>再把图上有的边连上，费用为边权，容量为无穷。</br>
<br/>源点与起点终点连接，容量为 1 ，费用为 0 ；汇点与中转点连接，容量为 2 ，费用为 0 。</br>
<br/>如果流量为 2 ，则答案为费用，否则输出 -1 。</br>


## 2017qingdao k
题目链接：
### 题意
上一题的复杂版，从西安到上海后再从上海到青岛，最后从青岛返回上海。上海有两个机场，其中从西安到是到浦东机场到虹桥机场到青岛，青岛回上海是回虹桥机场。
### 题解
费用流

<br/>相当于求从起点和终点到中转点的最小费用和。</br>
<br/>因为限制点只能使用一次，所以拆点，i 和 i + 1 点的费用都为 0 ，容量青岛及虹桥容量为 2 ，其余点容量都为 1 。</br>
<br/>再把图上有的无向边连上，费用为边权，容量为无穷。</br>
<br/>源点与西安、青岛连接，西安容量为 1 ，青岛容量为 2 ，费用为 0 ；汇点与虹桥及浦东连接，虹桥容量为 2 ，浦东容量为 1 ，费用为 0 。</br>
<br/>如果流量为 3 ，则答案为费用，否则输出 -1 。</br>